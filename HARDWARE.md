# –ê–ø–ø–∞—Ä–∞—Ç–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è STM32 Logic Analyzer

**–ú–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä:** STM32F401CCUx (UFQFPN48)
**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** https://github.com/kvas00/stm32-logic-analyzer

---

## üîå GPIO –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

| –ü–∏–Ω   | –§—É–Ω–∫—Ü–∏—è         | –û–ø–∏—Å–∞–Ω–∏–µ                          | –ü—Ä–∏–º–µ—á–∞–Ω–∏—è                    |
|-------|-----------------|-----------------------------------|-------------------------------|
| PC13  | LED             | –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Å–≤–µ—Ç–æ–¥–∏–æ–¥ –Ω–∞ –ø–ª–∞—Ç–µ     | Active LOW                    |
| PA0   | TEST_BTN        | –ö–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥–∞ –≤ —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º     | Active LOW, pull-up           |
| PB15  | ENCODER_A       | –≠–Ω–∫–æ–¥–µ—Ä - –∫–∞–Ω–∞–ª A                 | Pull-up, interrupt            |
| PB14  | ENCODER_B       | –≠–Ω–∫–æ–¥–µ—Ä - –∫–∞–Ω–∞–ª B                 | Pull-up, interrupt            |
| PB13  | ENCODER_ENTER   | –ö–Ω–æ–ø–∫–∞ —ç–Ω–∫–æ–¥–µ—Ä–∞                   | Active LOW, pull-up           |
| PB12  | GND_PIN         | –û–±—â–∏–π –ø—Ä–æ–≤–æ–¥ (GND)                | –î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è      |

### –î–µ—Ç–∞–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è GPIO

#### LED (PC13)
- **–¢–∏–ø:** Push-Pull Output
- **–°–∫–æ—Ä–æ—Å—Ç—å:** Low
- **–õ–æ–≥–∏–∫–∞:** Active LOW (—Å–≤–µ—Ç–∏—Ç—Å—è –ø—Ä–∏ LOW)
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –ò–Ω–¥–∏–∫–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã

#### TEST_BTN (PA0)
- **–¢–∏–ø:** Input
- **Pull:** Pull-up (–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ø–æ–¥—Ç—è–∂–∫–∞)
- **–õ–æ–≥–∏–∫–∞:** Active LOW (–Ω–∞–∂–∞—Ç–∞ = GND)
- **–§—É–Ω–∫—Ü–∏—è:** –ê–∫—Ç–∏–≤–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

#### –≠–Ω–∫–æ–¥–µ—Ä (PB15, PB14, PB13)
- **–¢–∏–ø:** Input —Å –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è–º–∏
- **Pull:** Pull-up (–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ø–æ–¥—Ç—è–∂–∫–∞)
- **–ß–∞—Å—Ç–æ—Ç–∞ –æ–ø—Ä–æ—Å–∞:** –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –ø–æ –∏–∑–º–µ–Ω–µ–Ω–∏—é —Å–∏–≥–Ω–∞–ª–∞
- **Debounce:** –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π (–≤ –∫–ª–∞—Å—Å–µ Encoder)

---

## üñ•Ô∏è –ü–µ—Ä–∏—Ñ–µ—Ä–∏–π–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

### I2C1 - OLED –¥–∏—Å–ø–ª–µ–π

| –ü–∞—Ä–∞–º–µ—Ç—Ä          | –ó–Ω–∞—á–µ–Ω–∏–µ                     |
|-------------------|------------------------------|
| **–ü–∏–Ω—ã**          | PB6 (SCL), PB7 (SDA)         |
| **–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ**    | SH1106 OLED 128x64           |
| **–ß–∞—Å—Ç–æ—Ç–∞**       | 400 kHz (Fast Mode)          |
| **–ê–¥—Ä–µ—Å**         | 0x3C (7-bit)                 |
| **–†–µ–∂–∏–º**         | Master                       |
| **–ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ**    | 3.3V                         |

#### –°—Ö–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è OLED

```
STM32F401           SH1106 OLED
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     PB6 ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ SCL      ‚îÇ
‚îÇ     PB7 ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ SDA      ‚îÇ
‚îÇ     GND ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ GND      ‚îÇ
‚îÇ    3.3V ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ VCC      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:**
- –ù–∞ –ø–ª–∞—Ç–µ –º–æ–≥—É—Ç –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã pull-up —Ä–µ–∑–∏—Å—Ç–æ—Ä—ã (–æ–±—ã—á–Ω–æ 4.7 –∫–û–º)
- –ï—Å–ª–∏ –¥–∏—Å–ø–ª–µ–π –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–¥—Ä–µ—Å (–º–æ–∂–µ—Ç –±—ã—Ç—å 0x3D)
- –î–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –ø—Ä–æ–≤–æ–¥–æ–≤ (<10 —Å–º) —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–Ω–∏–∑–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É –¥–æ 100 kHz

---

### USART1 - –û—Ç–ª–∞–¥–æ—á–Ω—ã–π UART

| –ü–∞—Ä–∞–º–µ—Ç—Ä          | –ó–Ω–∞—á–µ–Ω–∏–µ                     |
|-------------------|------------------------------|
| **–ü–∏–Ω—ã**          | PA9 (TX), PA10 (RX)          |
| **–°–∫–æ—Ä–æ—Å—Ç—å**      | 115200 baud                  |
| **–§–æ—Ä–º–∞—Ç**        | 8N1 (8 –±–∏—Ç –¥–∞–Ω–Ω—ã—Ö, –Ω–µ—Ç —á–µ—Ç–Ω–æ—Å—Ç–∏, 1 —Å—Ç–æ–ø-–±–∏—Ç) |
| **–£—Ä–æ–≤–Ω–∏**        | 3.3V TTL                     |

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ USB CDC

#### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ USB-UART –∞–¥–∞–ø—Ç–µ—Ä–∞

```
STM32F401       USB-UART
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PA9 TX ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ RX      ‚îÇ
‚îÇ PA10 RX ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ TX      ‚îÇ
‚îÇ     GND ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ GND     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–í–∞–∂–Ω–æ:** TX –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ RX –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç!

---

### USB OTG FS - Virtual COM Port

| –ü–∞—Ä–∞–º–µ—Ç—Ä          | –ó–Ω–∞—á–µ–Ω–∏–µ                     |
|-------------------|------------------------------|
| **–ü–∏–Ω—ã**          | PA11 (USB_DM), PA12 (USB_DP) |
| **–°–∫–æ—Ä–æ—Å—Ç—å**      | Full Speed (12 Mbps)         |
| **–ö–ª–∞—Å—Å**         | CDC (Virtual COM Port)       |
| **VID:PID**       | 0x0483:0x5740 (STM32)        |

**–§—É–Ω–∫—Ü–∏–∏:**
- –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π COM-–ø–æ—Ä—Ç –¥–ª—è —Å–≤—è–∑–∏ —Å –ü–ö
- –ü–µ—Ä–µ–¥–∞—á–∞ –ª–æ–≥–æ–≤ –∏ –¥–∞–Ω–Ω—ã—Ö
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –¥—Ä–∞–π–≤–µ—Ä–æ–≤ –Ω–∞ Linux/macOS

#### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

**Linux:**
```bash
# –ù–∞–π—Ç–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
ls /dev/ttyACM*

# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ø–æ—Ä—Ç—É
screen /dev/ttyACM0 115200
```

**Windows:**
- –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫–∞–∫ COM-–ø–æ—Ä—Ç
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ PuTTY, Tera Term –∏–ª–∏ Device Manager

---

### RTC - –ß–∞—Å—ã —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä          | –ó–Ω–∞—á–µ–Ω–∏–µ                     |
|-------------------|------------------------------|
| **–ü–∏–Ω—ã**          | PC14 (OSC32_IN), PC15 (OSC32_OUT) |
| **–ò—Å—Ç–æ—á–Ω–∏–∫**      | LSE (Low Speed External)     |
| **–ß–∞—Å—Ç–æ—Ç–∞**       | 32.768 kHz                   |
| **–ö–≤–∞—Ä—Ü**         | –ß–∞—Å–æ–≤–æ–π –∫–≤–∞—Ä—Ü–µ–≤—ã–π —Ä–µ–∑–æ–Ω–∞—Ç–æ—Ä  |
| **–¢–æ—á–Ω–æ—Å—Ç—å**      | ¬±20 ppm (–ø—Ä–∏ 25¬∞C)           |

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –ú–µ—Ç–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –≤ –ª–æ–≥–∞—Ö
- –ò–∑–º–µ—Ä–µ–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–æ–±—ã—Ç–∏–π
- –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ë–∞—Ç–∞—Ä–µ–π–∫–∞ CR2032 –Ω–∞ –ø–ª–∞—Ç–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç RTC —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ –ø–∏—Ç–∞–Ω–∏—è.

---

## ‚è±Ô∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ò—Å—Ç–æ—á–Ω–∏–∫–∏ —Ç–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

| –ò—Å—Ç–æ—á–Ω–∏–∫ | –ß–∞—Å—Ç–æ—Ç–∞   | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                    |
|----------|-----------|-------------------------------|
| **HSE**  | 25 MHz    | –í–Ω–µ—à–Ω–∏–π –∫–≤–∞—Ä—Ü (–æ—Å–Ω–æ–≤–Ω–æ–π)      |
| **LSE**  | 32.768 kHz| RTC                           |
| **HSI**  | 16 MHz    | –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π RC (—Ä–µ–∑–µ—Ä–≤)        |
| **PLL**  | 336 MHz   | VCO –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SYSCLK      |

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —á–∞—Å—Ç–æ—Ç—ã

```
HSE (25 MHz)
    ‚Üì
  PLLM (/25)
    ‚Üì
VCO_IN (1 MHz)
    ‚Üì
  PLLN (√ó336)
    ‚Üì
VCO_OUT (336 MHz)
    ‚Üì
  ‚îú‚îÄ PLLP (/4) ‚Üí SYSCLK (84 MHz)
  ‚îî‚îÄ PLLQ (/7) ‚Üí USB CLK (48 MHz)
```

### –®–∏–Ω—ã –∏ –ø–µ—Ä–∏—Ñ–µ—Ä–∏—è

| –®–∏–Ω–∞/–ü–µ—Ä–∏—Ñ–µ—Ä–∏—è | –ß–∞—Å—Ç–æ—Ç–∞ | –î–µ–ª–∏—Ç–µ–ª—å | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ              |
|----------------|---------|----------|----------------------------|
| **SYSCLK**     | 84 MHz  | -        | –Ø–¥—Ä–æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞            |
| **AHB**        | 84 MHz  | /1       | –ü–∞–º—è—Ç—å, DMA                |
| **APB1**       | 42 MHz  | /2       | I2C1, TIM2-5, USART2-3     |
| **APB2**       | 84 MHz  | /1       | USART1, TIM1, TIM9-11, SPI |
| **USB**        | 48 MHz  | –æ—Ç PLLQ  | USB OTG FS                 |
| **RTC**        | 32.768 kHz | –æ—Ç LSE | RTC                        |

### PLL —Ä–∞—Å—á–µ—Ç—ã

```c
// –ü–∞—Ä–∞–º–µ—Ç—Ä—ã PLL
#define PLLM  25   // HSE / 25 = 1 MHz
#define PLLN  336  // VCO = 1 MHz √ó 336 = 336 MHz
#define PLLP  4    // SYSCLK = 336 MHz / 4 = 84 MHz
#define PLLQ  7    // USB = 336 MHz / 7 = 48 MHz

// –§–æ—Ä–º—É–ª—ã
VCO_IN  = HSE / PLLM = 25 MHz / 25 = 1 MHz
VCO_OUT = VCO_IN √ó PLLN = 1 MHz √ó 336 = 336 MHz
SYSCLK  = VCO_OUT / PLLP = 336 MHz / 4 = 84 MHz
USB_CLK = VCO_OUT / PLLQ = 336 MHz / 7 = 48 MHz
```

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è STM32F401:**
- VCO_IN: 1-2 MHz (–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ 1-2 MHz)
- VCO_OUT: 192-432 MHz
- SYSCLK: –¥–æ 84 MHz
- USB: —Å—Ç—Ä–æ–≥–æ 48 MHz

---

## üîÑ –°—Ö–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —ç–Ω–∫–æ–¥–µ—Ä–∞

### –†–æ—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π —ç–Ω–∫–æ–¥–µ—Ä KY-040

```
Rotary Encoder      STM32F401
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     CLK    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ PB15    ‚îÇ  (Channel A / ENCODER_A)
‚îÇ     DT     ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ PB14    ‚îÇ  (Channel B / ENCODER_B)
‚îÇ     SW     ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ PB13    ‚îÇ  (Button / ENCODER_ENTER)
‚îÇ     +      ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ 3.3V    ‚îÇ
‚îÇ     GND    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ GND/PB12‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –†–∞—Å–ø–∏–Ω–æ–≤–∫–∞ —ç–Ω–∫–æ–¥–µ—Ä–∞

| –ü–∏–Ω —ç–Ω–∫–æ–¥–µ—Ä–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ           | –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ STM32 |
|--------------|----------------------|-------------------|
| CLK          | –ö–∞–Ω–∞–ª A (—Ñ–∞–∑–∞ A)     | PB15              |
| DT           | –ö–∞–Ω–∞–ª B (—Ñ–∞–∑–∞ B)     | PB14              |
| SW           | –ö–Ω–æ–ø–∫–∞ (–Ω–∞–∂–∞—Ç–∏–µ)     | PB13              |
| +            | –ü–∏—Ç–∞–Ω–∏–µ 3.3V/5V      | 3.3V              |
| GND          | –û–±—â–∏–π –ø—Ä–æ–≤–æ–¥         | GND –∏–ª–∏ PB12      |

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

–≠–Ω–∫–æ–¥–µ—Ä –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–≤–∞ —Å–¥–≤–∏–Ω—É—Ç—ã—Ö –ø–æ —Ñ–∞–∑–µ —Å–∏–≥–Ω–∞–ª–∞ (A –∏ B):
- **–ü–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ:** A –æ–ø–µ—Ä–µ–∂–∞–µ—Ç B –Ω–∞ 90¬∞
- **–ü—Ä–æ—Ç–∏–≤ —á–∞—Å–æ–≤–æ–π:** B –æ–ø–µ—Ä–µ–∂–∞–µ—Ç A –Ω–∞ 90¬∞

```
–í—Ä–∞—â–µ–Ω–∏–µ CW (–ø–æ —á–∞—Å–æ–≤–æ–π):
A: ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ
     ‚îî‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îò
B: ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îê
       ‚îî‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ

–í—Ä–∞—â–µ–Ω–∏–µ CCW (–ø—Ä–æ—Ç–∏–≤ —á–∞—Å–æ–≤–æ–π):
A: ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îê
       ‚îî‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ
B: ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ
     ‚îî‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îò
```

**–ö–ª–∞—Å—Å Encoder** –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —ç—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–∞—â–µ–Ω–∏—è.

---

## üìä –ü–æ—Ç—Ä–µ–±–ª—è–µ–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –ü–∞–º—è—Ç—å (—Ç–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è)

| –¢–∏–ø   | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ | –í—Å–µ–≥–æ  | –ü—Ä–æ—Ü–µ–Ω—Ç | –°–≤–æ–±–æ–¥–Ω–æ |
|-------|--------------|--------|---------|----------|
| Flash | 65,832 –ë     | 256 –ö–ë | 25.7%   | 190 –ö–ë   |
| RAM   | 27,120 –ë     | 64 –ö–ë  | 41.4%   | 37 –ö–ë    |

```
Memory region         Used Size  Region Size  %age Used
             RAM:       27120 B        64 KB     41.38%
           FLASH:       65832 B       256 KB     25.11%
```

### –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ Flash (–ø—Ä–∏–º–µ—Ä–Ω–æ–µ)

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç              | –†–∞–∑–º–µ—Ä   | –ü—Ä–æ—Ü–µ–Ω—Ç |
|------------------------|----------|---------|
| HAL –¥—Ä–∞–π–≤–µ—Ä—ã           | ~25 –ö–ë   | 38%     |
| FreeRTOS               | ~10 –ö–ë   | 15%     |
| USB CDC Middleware     | ~8 –ö–ë    | 12%     |
| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–¥   | ~15 –ö–ë   | 23%     |
| OLED –¥—Ä–∞–π–≤–µ—Ä           | ~5 –ö–ë    | 8%      |
| –ü—Ä–æ—á–µ–µ                 | ~2.8 –ö–ë  | 4%      |

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–∏—Ñ–µ—Ä–∏–∏

| –ü–µ—Ä–∏—Ñ–µ—Ä–∏—è     | –°–æ—Å—Ç–æ—è–Ω–∏–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                |
|---------------|-----------|---------------------------|
| I2C1          | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | OLED –¥–∏—Å–ø–ª–µ–π SH1106       |
| USART1        | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | –û—Ç–ª–∞–¥–æ—á–Ω—ã–π UART           |
| USB OTG FS    | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | Virtual COM Port          |
| RTC           | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | –ß–∞—Å—ã —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏    |
| TIM10         | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | HAL timebase (SysTick)    |
| GPIO (A,B,C)  | ‚úÖ –ê–∫—Ç–∏–≤–µ–Ω | LED, –∫–Ω–æ–ø–∫–∏, —ç–Ω–∫–æ–¥–µ—Ä      |
| DMA           | ‚ö™ –†–µ–∑–µ—Ä–≤  | –î–ª—è –±—É–¥—É—â–∏—Ö —É–ª—É—á—à–µ–Ω–∏–π     |
| SPI1/2        | ‚ö™ –†–µ–∑–µ—Ä–≤  | –°–≤–æ–±–æ–¥–µ–Ω                  |
| ADC1          | ‚ö™ –†–µ–∑–µ—Ä–≤  | –°–≤–æ–±–æ–¥–µ–Ω                  |
| TIM1-5,9,11   | ‚ö™ –†–µ–∑–µ—Ä–≤  | –°–≤–æ–±–æ–¥–Ω—ã                  |

---

## üîß –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### FreeRTOS –∑–∞–¥–∞—á–∏

| –ó–∞–¥–∞—á–∞            | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | Stack | –§—É–Ω–∫—Ü–∏—è                          |
|-------------------|-----------|-------|----------------------------------|
| defaultTask       | Normal    | 128 B | –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ        |
| Encoder Task      | High      | 256 B | –û–ø—Ä–æ—Å —ç–Ω–∫–æ–¥–µ—Ä–∞, –æ–±—Ä–∞–±–æ—Ç–∫–∞        |
| Display Task      | Normal    | 512 B | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ OLED –¥–∏—Å–ø–ª–µ—è          |

### Middleware

- **STM32 USB Device Library** - CDC Virtual COM Port
- **FreeRTOS 10.x** - RTOS —Å CMSIS-RTOS v2 API
- **HAL Driver** - STM32F4xx Hardware Abstraction Layer

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–ª–∞—Å—Å—ã (C++)

| –ö–ª–∞—Å—Å     | –§–∞–π–ª         | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                       |
|-----------|--------------|----------------------------------|
| Encoder   | Encoder.cpp  | –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–æ—Ç–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —ç–Ω–∫–æ–¥–µ—Ä–∞  |
| Led       | Led.cpp      | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º LED        |
| Oled      | Oled.cpp     | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ OLED –¥–∏—Å–ø–ª–µ–µ–º         |
| Tasks     | Tasks.cpp    | FreeRTOS –∑–∞–¥–∞—á–∏ –∏ –ª–æ–≥–∏–∫–∞         |

---

## üõ†Ô∏è –û—Ç–ª–∞–¥–∫–∞ –∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ

### ST-Link V2 –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

```
ST-Link V2          STM32F401
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  SWDIO  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ PA13    ‚îÇ
‚îÇ  SWCLK  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ PA14    ‚îÇ
‚îÇ   GND   ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ GND     ‚îÇ
‚îÇ  3.3V   ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ 3.3V    ‚îÇ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** 3.3V –æ—Ç ST-Link –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø–∏—Ç–∞–Ω–∏—è –ø–ª–∞—Ç—ã –ø—Ä–∏ –æ—Ç–ª–∞–¥–∫–µ.

### –ö–æ–º–∞–Ω–¥—ã –ø—Ä–æ—à–∏–≤–∫–∏

```bash
# –ü—Ä–æ—à–∏–≤–∫–∞ —á–µ—Ä–µ–∑ st-flash
st-flash write build/logic-analyzer.bin 0x8000000

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
st-info --probe

# –ß—Ç–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
st-flash read firmware_backup.bin 0x8000000 0x40000

# –°—Ç–∏—Ä–∞–Ω–∏–µ —á–∏–ø–∞
st-flash erase
```

### –û—Ç–ª–∞–¥–∫–∞ —á–µ—Ä–µ–∑ GDB

```bash
# –ó–∞–ø—É—Å–∫ GDB —Å–µ—Ä–≤–µ—Ä–∞
st-util

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
arm-none-eabi-gdb build/logic-analyzer.elf
(gdb) target extended-remote :4242
(gdb) load
(gdb) continue
```

---

## üìê –§–∏–∑–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–º–µ—Ä—ã –∏ –ø–∏—Ç–∞–Ω–∏–µ

### –ü–ª–∞—Ç–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (Black Pill STM32F401)

- **–†–∞–∑–º–µ—Ä—ã:** ~53 √ó 23 –º–º
- **–ú–∞—Å—Å–∞:** ~3 –≥
- **–†–∞–∑—ä–µ–º:** USB-C (–ø–∏—Ç–∞–Ω–∏–µ + –¥–∞–Ω–Ω—ã–µ)
- **–ë–∞—Ç–∞—Ä–µ–π–∫–∞ RTC:** CR2032 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ü–∏—Ç–∞–Ω–∏–µ

| –ü–∞—Ä–∞–º–µ—Ç—Ä               | –ú–∏–Ω.  | –¢–∏–ø–∏—á–Ω–æ | –ú–∞–∫—Å.  |
|------------------------|-------|---------|--------|
| –ù–∞–ø—Ä—è–∂–µ–Ω–∏–µ –ø–∏—Ç–∞–Ω–∏—è     | 2.0V  | 3.3V    | 3.6V   |
| –¢–æ–∫ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è (idle) | -     | 30 mA   | -      |
| –¢–æ–∫ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è (max)  | -     | 80 mA   | 100 mA |
| –ü–∏—Ç–∞–Ω–∏–µ –æ—Ç USB         | 5V ‚Üí 3.3V —Ä–µ–≥—É–ª—è—Ç–æ—Ä    |

**–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –ø–∏—Ç–∞–Ω–∏—è:**
1. USB (5V ‚Üí AMS1117 ‚Üí 3.3V)
2. –í–Ω–µ—à–Ω–∏–π 3.3V –Ω–∞ –ø–∏–Ω 3.3V
3. –ë–∞—Ç–∞—Ä–µ–π–∫–∞ CR2032 (—Ç–æ–ª—å–∫–æ –¥–ª—è RTC)

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–π —á–∞—Å—Ç–∏

### –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º:

1. –ó–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∞ PA0 –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏
2. –ù–∞ –¥–∏—Å–ø–ª–µ–µ –ø–æ—è–≤–∏—Ç—Å—è "TEST MODE"
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - –í—Ä–∞—â–µ–Ω–∏–µ —ç–Ω–∫–æ–¥–µ—Ä–∞ –∏–∑–º–µ–Ω—è–µ—Ç –ø–æ–∑–∏—Ü–∏—é
   - –ù–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ —ç–Ω–∫–æ–¥–µ—Ä–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
   - USB CDC –≤—ã–≤–æ–¥–∏—Ç –ª–æ–≥–∏

–°–º. [TEST_MODE.md](TEST_MODE.md) –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ OLED

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–¥—Ä–µ—Å I2C —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (Linux)
i2cdetect -y 1

# –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å 0x3C (–∏–ª–∏ 0x3D)
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ USB CDC

```bash
# Linux
ls -l /dev/ttyACM*
screen /dev/ttyACM0 115200

# –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ª–æ–≥–∏ –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
```

---

## üìñ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **STM32F401 Datasheet:** [STM32F401xB/C](https://www.st.com/resource/en/datasheet/stm32f401cb.pdf)
- **STM32F401 Reference Manual:** [RM0368](https://www.st.com/resource/en/reference_manual/dm00096844.pdf)
- **SH1106 Datasheet:** [SH1106 OLED Controller](https://www.velleman.eu/downloads/29/infosheets/sh1106_datasheet.pdf)

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

- **STM32CubeMX:** –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–µ—Ä–∏—Ñ–µ—Ä–∏–∏
- **ST-Link Utility:** –ü—Ä–æ—à–∏–≤–∫–∞ –∏ –æ—Ç–ª–∞–¥–∫–∞ (GUI)
- **STM32CubeProgrammer:** –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–∞–º–º–∞—Ç–æ—Ä –æ—Ç ST

### –°—Ö–µ–º—ã –∏ pinout

- **Black Pill pinout:** [STM32F401CCU6 Pinout](https://stm32-base.org/boards/STM32F401CCU6-WeAct-Black-Pill-V3.0.html)
- **Rotary Encoder KY-040:** –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ä–∞—Å–ø–∏–Ω–æ–≤–∫–∞

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-12-11
**–ê–≤—Ç–æ—Ä—ã:** Claude Code + Victor
**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:** https://github.com/kvas00/stm32-logic-analyzer
