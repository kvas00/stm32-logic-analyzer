# Encoder-Only Project - Version 0.1

**Дата создания резервной копии:** 2025-10-10
**Тег версии:** Version 0.1

## Описание

Первая стабильная версия проекта с поддержкой C++. Базовая функциональность работы с энкодером и LED индикацией.

## Функциональность

### Аппаратная конфигурация
- **Контроллер:** STM32F401xC
- **Энкодер:**
  - Канал A: PB15 (с прерыванием)
  - Канал B: PB14
  - Кнопка: PB13
  - GND: PB12
- **LED:** PC13 (активный низкий уровень)
- **Интерфейсы:**
  - USART1 (115200 baud)
  - USB-CDC (виртуальный COM-порт)

### Реализованные возможности

1. **Обработка вращения энкодера:**
   - CW (по часовой) → двойной блинк LED
   - CCW (против часовой) → одиночный блинк LED
   - Счетчик позиции с выводом в лог

2. **Обработка кнопки энкодера:**
   - Нажатие → LED включается
   - Отпускание → LED выключается
   - Длинное нажатие (1 сек) → сброс счетчика позиции в 0

3. **Система логирования:**
   - Параллельный вывод в USART1 и USB-CDC
   - Информация о событиях с временными метками
   - Вывод текущей позиции и направления вращения

## Архитектура

### Язык программирования
- **C++17** для пользовательского кода
- **C** для HAL драйверов STM32

### Классы

#### `Led` (Core/Lib/Led.h, Led.cpp)
Класс для управления светодиодом:
- `on()` - включить LED
- `off()` - выключить LED
- `toggle()` - переключить состояние
- `blink(duration_ms)` - одиночное мигание
- `doubleBlink()` - двойное мигание
- `singleBlink()` - одиночное мигание (100ms)

#### `Encoder` (Core/Lib/Encoder.h, Encoder.cpp)
Класс для работы с энкодером:
- `init()` - инициализация
- `update()` - обновление состояния (вызывать в основном цикле)
- `handleInterrupt()` - обработчик прерывания
- `getPosition()` - получить текущую позицию
- `resetPosition()` - сбросить позицию в 0
- `getDelta()` - получить изменение позиции
- `isButtonPressed()` - проверка нажатия кнопки
- `isButtonReleased()` - проверка отпускания кнопки
- `isLongPress()` - проверка длинного нажатия

### Структура файлов

```
Core/
  ├── Inc/
  │   └── main.h              - Заголовочный файл проекта
  ├── Src/
  │   ├── main.cpp            - Основной файл программы (C++)
  │   ├── stm32f4xx_it.c      - Обработчики прерываний
  │   └── stm32f4xx_hal_msp.c - MSP инициализация HAL
  └── Lib/                    - Пользовательские библиотеки
      ├── Encoder.h
      ├── Encoder.cpp
      ├── Led.h
      └── Led.cpp

USB_DEVICE/                   - USB CDC библиотеки
cmake/                        - CMake конфигурация
CMakeLists.txt                - Основной CMake файл
```

## Сборка проекта

```bash
mkdir build
cd build
cmake ..
make
```

## Примечания

- Дебаунсинг кнопки: 20 мс
- Длительность длинного нажатия: 1000 мс (1 сек)
- Скорость UART: 115200 baud
- Все логи дублируются в UART1 и USB-CDC

## Известные особенности

- При быстром вращении энкодер может генерировать несколько импульсов на один щелчок
- LED блинки выполняются с блокировкой (HAL_Delay)

## История изменений

### Version 0.1 (2025-10-10)
- Первая версия с поддержкой C++
- Реализованы классы Led и Encoder
- Переведен main.c → main.cpp
- Добавлена поддержка USB-CDC и UART1
- Базовая функциональность энкодера и LED индикации
